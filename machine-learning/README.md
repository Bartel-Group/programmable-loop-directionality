# Machine learning of microkinetic data

--------------------

Overview of the data
--------------------

This folder includes scripts and data files used to train and evaluate machine learning models on the microkinetic data generated from the loop simulation. The `xgb_env.yml` file is included such that anyone may recreate the environment used to generate the machine learning results. Rate constant models and grid searches are provided, though not thoroughly dicussed in the manuscript. Further analysis of the rate constant (`rc`) models is possible by including the `rc` model_tag in the main function of the analysis scripts. Finally, the .py files in `scripts` are meant to be run in the order they are numbered (i.e. one may run any of the scripts beginning in `3-` after running `1-` and `2-`, but should not run `3-` before all of `1-` and `2-`).

--------------------------

SHARING/ACCESS INFORMATION
--------------------------

Terms of Use: Data Repository for the U of Minnesota (DRUM) By using these files, users agree to the Terms of Use. <https://conservancy.umn.edu/pages/drum/policies/#terms-of-use>

---------------------

SUBFOLDER/FILE OVERVIEW
---------------------

   Counterfactual results: Contains the .csvs of each counterfactual prediction. The numbers represent the perturbation of the input parameters that result in a successful change of label. The counterfactuals are generated by the `3-generate-counterfactual-data.py` script.

         A. Filename: counterfactual-perturbations-0-to-1.csv
            Description: Counterfactuals for the change from 0 (zero TOF) to 1 (positive TOF) in the label. The numbers represent the perturbation of the input parameters that result in a successful change of label.
         
         B. Filename: counterfactual-perturbations-1-to-2.csv
            Description: Counterfactuals for the change from 1 (positive TOF) to 2 (negative TOF) in the label. The numbers represent the perturbation of the input parameters that result in a successful change of label.

         C. Filename: counterfactual-perturbations-2-to-1.csv
            Description: Counterfactuals for the change from 2 (negative TOF) to 1 (positive TOF) in the label. The numbers represent the perturbation of the input parameters that result in a successful change of label.

   \
   Grid search results: Contains the .pkl files of the grid search results and best estimators for each unique combination of model type (clf, reg) and dataset (original, rate constant). The grid search results are generated by the `2-xgb_clf_random-cv.py` and `2-xgb_reg_random-cv.py` scripts.

         A. Filename: xgb_{model_type}_{dataset}-best-estm.pkl
            Description: The best estimator for each unique combination of model type (clf, reg) and dataset (original, rate constant) from the grid search results.

         B. Filename: xgb_{model_type}_{dataset}.pkl
            Description: The full grid search results object for each unique combination of model type (clf, reg) and dataset (original, rate constant).

   \
   Scripts: Contains the .py files used to generate the machine learning results. The scripts are meant to be run in the order they are numbered, where any script beginning in the same number may be run in any order.

         A. Filename: 1-preprocess-splits.py
            Description: Preprocesses the final loop simulation data by separating steady and transient states as well as adjusting any |TOF| < 1e-4 to 0 (see manuscript for explanation). The training data is saved as `ml_data_op_steady.csv` and `ml_data_rc_steady.csv`.

         B. Filename: 1.5-data-visulization.py
            Description: Used to visualize the distribution of the turnover frequency across the full dataset. (Generates figures 2 and 3 in the manuscript)

         C. Filename: 2-xgb_clf_random-cv.py
            Description: Trains and saves both the original parameter and rate constant classification models using a random grid search. The best estimator and full grid search results are saved in `machine-learning/grid-search-results`.

         D. Filename: 2-xgb_reg_random-cv.py
            Description: Trains and saves both the original parameter and rate constant regression models using a random grid search. The best estimator and full grid search results are saved in `machine-learning/grid-search-results`.

         E. Filename: 2.5-generate-counterfactual-data.py
            Description: Used to generate the counterfactual data for the best estimators. The counterfactuals are saved in `machine-learning/counterfactual-results`. See manuscript for additional information about which counterfactuals are generated.

         F. Filename: 3-check-model-errors.py
            Description: Used to check the errors of the best estimators for each unique combination of model type (clf, reg) and dataset (original, rate constant) from the grid search results. This script will print the metrics that are reported in the manuscript as well as baseline metrics. This is also used to generate the hexbin parity plots (figure 6 of the manuscript).
         
         G. Filename: 3-feature-importance.py
            Description: Used to generate the feature importance plots for the best estimators and perform permutation feature importance. This also generates the feature importance plots for figures 4 and 7 of the manuscript.
         
         H. Filename: 3-plot-counterfactuals.py
            Description: Used to plot the counterfactuals generated by the `2.5-generate-counterfactual-data.py` script. This script computes the normalized mean perturbation of each feature and produces figure 5 of the manuscript.

         I. Filename: 3-shap-importance.py
            Description: Used to generate the SHAP importance data and plots for the best estimators. The SHAP importance plots are found in figures 4 and 7 of the manuscript.

   \
   Training data: Contains the .csv files of the training data used to train the machine learning models. The training data is generated by the `1-preprocess-splits.py` script.

         A. Filename: ml_data_op_steady.csv
            Description: Data used to train all original parameter models, further class labeling and seperation into training and testing data is done in the respective training scripts.
         
         B. Filename: ml_data_rc_steady.csv
            Description: Data used to train all rate constant models, further class labeling and seperation into training and testing data is done in the respective training scripts.
